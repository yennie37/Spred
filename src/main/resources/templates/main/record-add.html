<!-- ########################### [start]_헤더 : 선언부 영역 ########################### -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기록추가하기</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="../../static/css/content.css">
    <script src="../../static/js/common.js"></script>
</head>
<body>
<div class="wrap">
<!-- ########################### [end]_헤더 : 선언부 영역 ########################### -->

<!-- ########################### [start]_컨텐츠 영역 ########################### -->
    <div class="container">
        <div class="content">
            <div class="header">
                <div class="left">
                    <button type="button" class="arrow-btn" title="이전 화면 이동하기"></button>
                    <h1><em>기록해연</em> 님의 응원 기록</h1>
                </div>
            </div>
            <h2 class="tit-d03">기본 정보</h2>
            <div class="form-group-wrap">
                <div class="form-group" role="radiogroup" aria-labelledby="matchType">
                    <h3 class="form-tit" id="matchType"><span>경기 종류</span></h3>
                    <div class="group-wrap">
                        <label class="form-item" for="preSeason">
                            <span class="rd-btn-txt">시범</span>
                            <input type="radio" name="plays" id="preSeason" class="radio-btn" value="preSeason" required>
                        </label>
                        <label class="form-item" for="regularSeason">
                            <span class="rd-btn-txt">정규</span>
                            <input type="radio" name="plays" id="regularSeason" class="radio-btn" value="regularSeason" required>
                        </label>
                        <label class="form-item" for="playOffs">
                            <span class="rd-btn-txt">포스트</span>
                            <input type="radio" name="plays" id="playOffs" class="radio-btn" value="playOffs" required>
                        </label>
                        <label class="form-item" for="otherPlay">
                            <span class="rd-btn-txt">기타</span>
                            <input type="radio" name="plays" id="otherPlay" class="radio-btn" value="otherPlay" required>
                        </label>
                    </div>
                </div>
                <!-- // -->
                <div class="form-group" role="radiogroup" aria-labelledby="selectDate">
                    <h3 class="form-tit" id="selectDate"><span>날짜</span></h3>
                    <div class="group-wrap">
                        <button type="button" id="showDate" class="data-input-box" aria-haspopup="dialog" aria-expanded="false" onclick="openModal('bottomSheet01');"><span id="displayDate">날짜 선택</span></button>
                    </div>
                </div>
                <!-- // -->
                <div class="form-group" role="radiogroup" aria-labelledby="selectTime">
                    <h3 class="form-tit" id="selectTime"><span>시간</span></h3>
                    <div class="group-wrap">
                        <button type="button" id="showTime" class="data-input-box" aria-haspopup="dialog" aria-expanded="false"><span id="displayTime">시간 선택</span></button>
                    </div>
                </div>
                <!-- // -->
            </div>
        </div>
        <!-- ########################### [start]_푸터 : 하단버튼 영역 ########################### -->
        <footer class="footer">
            <div class="wrap-btn">
                <button type="button" class="btn-comm-prime"><span>저장하기</span></button>
            </div>
        </footer>
        <!-- ########################### [end]_푸터 : 하단버튼 영역 ########################### -->
    </div>
</div>
<!-- ########################### [end]_컨텐츠 영역 ########################### -->

<!-- ########################### [start]_모달 영역 ########################### -->
<div class="modal btm-sheet" id="bottomSheet01">
    <div class="modal-container">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-tit">경기 시즌</h6>
                <button type="button" class="close-md" title="모달 닫기" onclick="dismissModal('bottomSheet01');"></button>
            </div>
            <div class="modal-content">
                <div class="calendar-wrap">
                    <div class="calender-head">
                        <button class="nav-btn" id="prevMonth" aria-label="이전 달 이동"></button>
                        <h7 class="month-tit" id="calendarTit" aria-live="polite">2026년 01월 28일</h7>
                        <button class="nav-btn" id="nextMonth" aria-label="다음 달 이동"></button>
                    </div>
                    <table class="data-table" role="grid">
                        <caption class="hide">월간 달력</caption>
                        <thead>
                            <tr>
                                <th scope="col" aria-label="일요일">일</th>
                                <th scope="col" aria-label="월요일">월</th>
                                <th scope="col" aria-label="화요일">화</th>
                                <th scope="col" aria-label="수요일">수</th>
                                <th scope="col" aria-label="목요일">목</th>
                                <th scope="col" aria-label="금요일">금</th>
                                <th scope="col" aria-label="토요일">토</th>
                            </tr>
                        </thead>
                        <tbody id="calendarBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <div class="btn-wrap">
                    <button class="btn-comm-prime" id="confirmBtn" onclick="dismissModal('bottomSheet01');"><span>선택 완료</span></button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    // --- [변수 선언] ---
    const showDateBtn = document.getElementById('showDate'); // 트리거 버튼
    const displayDateSpan = document.getElementById('displayDate'); // 날짜 표시될 텍스트
    const bottomSheet = document.getElementById('bottomSheet01'); // 모달

    // 달력 내부 요소
    const calendarBody = document.getElementById('calendarBody');
    const calendarTit = document.getElementById('calendarTit');
    const prevBtn = document.getElementById('prevMonth');
    const nextBtn = document.getElementById('nextMonth');
    const confirmBtn = document.getElementById('confirmBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');

    // 상태 변수
    let currentDate = new Date();
    let selectedDate = new Date();

    // --- [달력 렌더링 함수] (이전과 동일) ---
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        calendarTit.textContent = `${year}년 ${String(month + 1).padStart(2, '0')}월`;

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        let html = '';
        let dayCount = 1;
        let isMonthEnded = false;

        for (let i = 0; i < 6; i++) {
            if (isMonthEnded && i > 0) break;
            let rowHtml = '<tr>';
            for (let j = 0; j < 7; j++) {
                if ((i === 0 && j < firstDay) || dayCount > lastDate) {
                    rowHtml += '<td></td>';
                    if (dayCount > lastDate) isMonthEnded = true;
                } else {
                    const isToday = isSameDay(new Date(year, month, dayCount), new Date());
                    const isSelected = isSameDay(new Date(year, month, dayCount), selectedDate);

                    rowHtml += `<td><button type="button" class="date-btn ${isToday ? 'today' : ''}" aria-selected="${isSelected ? 'true' : 'false'}" data-day="${dayCount}" aria-label="${year}년 ${month + 1}월 ${dayCount}일">${dayCount}</button></td>`;
                    dayCount++;
                }
            }
            rowHtml += '</tr>';
            if (!isMonthEnded || (isMonthEnded && rowHtml.includes('date-btn'))) {
                html += rowHtml;
            }
        }
        calendarBody.innerHTML = html;
        addDateClickEvents();
    }

    function isSameDay(d1, d2) {
        return d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth() && d1.getDate() === d2.getDate();
    }

    function addDateClickEvents() {
        const buttons = calendarBody.querySelectorAll('.date-btn');
        buttons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const day = parseInt(e.target.dataset.day);
                selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                renderCalendar();
            });
        });
    }

    // --- [이벤트 핸들러 수정 부분] ---

    // 1. 모달 열기 (트리거 버튼 클릭)
    showDateBtn.addEventListener('click', () => {


        // 열릴 때, 현재 선택된 날짜가 있는 달을 보여줌
        currentDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);
        renderCalendar();
    });

    // 2. 모달 닫기 공통 함수
    // function closeSheet() {
    //     bottomSheet.classList.remove('show');
    //     showDateBtn.setAttribute('aria-expanded', 'false'); // 접근성: 닫힘 상태 명시
    //     showDateBtn.focus(); // 접근성: 초점을 다시 트리거 버튼으로 이동
    // }

    // 3. [핵심] 선택 완료 버튼 클릭 시 텍스트 변경
    confirmBtn.addEventListener('click', () => {
        const y = selectedDate.getFullYear();
        const m = String(selectedDate.getMonth() + 1).padStart(2, '0');
        const d = String(selectedDate.getDate()).padStart(2, '0');

        // 화면의 span 텍스트 업데이트 (예: 2024.05.20)
        displayDateSpan.textContent = `${y}.${m}.${d}`;

        // (옵션) 값이 입력되었음을 시각적으로 표시하기 위해 클래스 추가
        showDateBtn.classList.add('is-value');
    });

    // 4. 기타 닫기/이동 버튼
    if(closeModalBtn) closeModalBtn.addEventListener('click', closeSheet);

    prevBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    });

    nextBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    });

    // 초기화
    renderCalendar();
</script>
</body>
</html>